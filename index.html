<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>PilouTransport — Connexion</title>
<style>
  :root{--green:#0b8f3b;--dark:#0f1720;--muted:#888;--error:#d9534f}
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;background:#05060a;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial}
  .center{min-height:100vh;display:flex;align-items:center;justify-content:center;padding:20px}
  .card{width:100%;max-width:420px;background:#0b1220;border-radius:12px;padding:28px;box-shadow:0 8px 30px rgba(2,6,23,0.6);color:#e6eef8}
  h1{margin:0 0 18px;font-size:20px;text-align:center}
  label{display:block;font-size:13px;color:var(--muted);margin-bottom:6px}
  input[type="text"],input[type="password"]{width:100%;padding:12px 10px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:rgba(255,255,255,0.02);color:#fff;font-size:15px}
  .row{margin-bottom:14px}
  button{width:100%;padding:12px;border-radius:10px;border:0;background:var(--green);color:#fff;font-weight:600;font-size:15px;cursor:pointer}
  .error{color:var(--error);font-size:13px;margin-top:8px;text-align:center}
  .muted{color:var(--muted);font-size:13px;text-align:center;margin-top:10px}
  /* PilouTransport full screen */
  .fullscreen {
    position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:#05060a;z-index:30;
  }
  .pilou-text{font-size:36px;font-weight:700;color:#e6eef8}
  /* green NFC splash */
  .nfc-splash{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:var(--green);z-index:60;transition:opacity .25s}
  .nfc-name{font-size:34px;font-weight:700;color:#fff}
  .topbar {display:flex;justify-content:space-between;align-items:center;margin-bottom:14px}
  .logout {background:transparent;border:1px solid rgba(255,255,255,0.06);color:#fff;padding:8px 12px;border-radius:8px;cursor:pointer}
  @media (max-width:480px){.pilou-text{font-size:28px}}
</style>
</head>
<body>
  <!-- NFC splash (hidden by default) -->
  <div id="nfcSplash" class="nfc-splash" style="display:none;opacity:0">
    <div class="nfc-name">Ruben Vega</div>
  </div>

  <!-- Main content container -->
  <div id="main" class="center">
    <!-- Card content will be injected by JS -->
    <div class="card" id="cardContainer">
      <!-- content replaced by JS -->
    </div>
  </div>

<script>
(function(){
  const correctId = "ruben.vega";
  const correctPw = "30072012";
  const card = document.getElementById('cardContainer');
  const nfcSplash = document.getElementById('nfcSplash');

  // helper renderers
  function renderLogin() {
    card.innerHTML = `
      <div class="topbar"><div></div><div style="font-weight:700">PilouTransport</div></div>
      <h1>Connexion</h1>
      <div class="row">
        <label for="ident">Identifiant :</label>
        <input id="ident" type="text" autocomplete="username" />
      </div>
      <div class="row">
        <label for="pwd">Mot de passe :</label>
        <input id="pwd" type="password" autocomplete="current-password" />
      </div>
      <div class="row"><button id="btnConnect">Connecter</button></div>
      <div id="error" class="error" style="display:none"></div>
      <div class="muted">Identifiant example: <strong>ruben.vega</strong></div>
    `;
    document.getElementById('btnConnect').addEventListener('click', tryLogin);
    // allow Enter key
    document.getElementById('pwd').addEventListener('keydown', function(e){
      if(e.key === 'Enter') tryLogin();
    });
  }

  function renderPilouTransport() {
    card.innerHTML = `
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:14px">
        <div style="font-weight:700">PilouTransport</div>
        <button id="logoutBtn" class="logout">Se déconnecter</button>
      </div>
      <div style="display:flex;align-items:center;justify-content:center;height:160px">
        <div class="pilou-text">PilouTransport</div>
      </div>
      <div class="muted">Présente ta carte NFC pour l’écran d’identification.</div>
    `;
    document.getElementById('logoutBtn').addEventListener('click', ()=>{
      localStorage.removeItem('pilou_logged');
      renderLogin();
    });
  }

  function showError(msg) {
    const el = document.getElementById('error');
    el.textContent = msg;
    el.style.display = 'block';
    // clear inputs
    const i = document.getElementById('ident');
    const p = document.getElementById('pwd');
    if(i) i.value = '';
    if(p) p.value = '';
    // hide after 3s
    setTimeout(()=>{ if(el) el.style.display='none' }, 3000);
  }

  function tryLogin() {
    const i = document.getElementById('ident').value.trim();
    const p = document.getElementById('pwd').value;
    if(i === correctId && p === correctPw) {
      localStorage.setItem('pilou_logged','1');
      renderPilouTransport();
    } else {
      showError('Identifiant ou mot de passe invalide.');
    }
  }

  // NFC splash control
  function showNfcSplash() {
    nfcSplash.style.display = 'flex';
    // force reflow for transition
    requestAnimationFrame(()=> nfcSplash.style.opacity = '1');
    setTimeout(()=> {
      nfcSplash.style.opacity = '0';
      setTimeout(()=> nfcSplash.style.display = 'none', 300);
    }, 4000); // 4s visible
  }

  // Decide what to render initially
  function init() {
    // If URL contains ?nfc=1, show NFC splash behaviour
    const params = new URLSearchParams(window.location.search);
    const isNfc = params.get('nfc') === '1';

    const logged = localStorage.getItem('pilou_logged') === '1';

    // If NFC param present:
    if(isNfc) {
      // If logged in -> show green splash, then after hide go to PilouTransport
      if(logged) {
        showNfcSplash();
        // after splash finishes, show PilouTransport
        setTimeout(() => {
          renderPilouTransport();
        }, 4300);
      } else {
        // not logged: still show splash? we can show splash then go to login
        showNfcSplash();
        setTimeout(() => {
          renderLogin();
        }, 4300);
      }
      return;
    }

    // not NFC param: normal flow
    if(logged) {
      renderPilouTransport();
    } else {
      renderLogin();
    }
  }

  // run
  init();

  // Expose a small helper for debugging (optional)
  window.__Pilou = {
    logout(){ localStorage.removeItem('pilou_logged'); renderLogin(); },
    login(){ localStorage.setItem('pilou_logged','1'); renderPilouTransport(); }
  };

})();
</script>
</body>
</html>
